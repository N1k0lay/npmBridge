# npmBridge

**npmBridge** โ ะฒะตะฑ-ะธะฝัะตััะตะนั ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะปะพะบะฐะปัะฝัะผ NPM-ัะตะฟะพะทะธัะพัะธะตะผ ะฝะฐ ะฑะฐะทะต Verdaccio. ะัะตะดะฝะฐะทะฝะฐัะตะฝ ะดะปั ะบะตัะธัะพะฒะฐะฝะธั ะฟะฐะบะตัะพะฒ ะธะท ะธะฝัะตัะฝะตัะฐ ะธ ะฟะพัะปะตะดัััะตะณะพ ะฟะตัะตะฝะพัะฐ ะฒ ะธะทะพะปะธัะพะฒะฐะฝะฝัะต ะบะพัะฟะพัะฐัะธะฒะฝัะต ัะตัะธ.

## ๐ฏ ะะฐะทะฝะฐัะตะฝะธะต

```
โโโโโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโโโโ
โ     ะะะขะะะะะข        โ         โ ะกะะะะะ ะก npmBridge  โ         โ   ะะะะ. ะกะะขะฌ        โ
โ   (registry.npmjs)  โ โโโโโโโบ โ   (ั ะธะฝัะตัะฝะตัะพะผ)    โ โโโโโโโบ โ   (ะฑะตะท ะธะฝัะตัะฝะตัะฐ)   โ
โโโโโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโโโโ
                                         โ
                                         โผ
                                โโโโโโโโโโโโโโโโโโโโโโโ
                                โ  โข ะะตัะธัะพะฒะฐะฝะธะต      โ
                                โ  โข ะะฑะฝะพะฒะปะตะฝะธะต       โ
                                โ  โข ะกะพะทะดะฐะฝะธะต diff    โ
                                โ  โข ะะตัะตะฝะพั ะฐััะธะฒะพะฒ  โ
                                โโโโโโโโโโโโโโโโโโโโโโโ
```

### ะขะธะฟะธัะฝัะน ััะตะฝะฐัะธะน ะธัะฟะพะปัะทะพะฒะฐะฝะธั

1. **ะะฐะบะพะฟะปะตะฝะธะต ะฟะฐะบะตัะพะฒ**: ะะฐะทัะฐะฑะพััะธะบะธ ัััะฐะฝะฐะฒะปะธะฒะฐัั ะฟะฐะบะตัั ัะตัะตะท Verdaccio โ ะฟะฐะบะตัั ะบะตัะธัััััั ะฒ `storage/`
2. **ะะฑะฝะพะฒะปะตะฝะธะต**: ะะตัะธะพะดะธัะตัะบะธ ะทะฐะฟััะบะฐะตััั ะพะฑะฝะพะฒะปะตะฝะธะต ะฒัะตั ะฟะฐะบะตัะพะฒ ะดะพ latest ะฒะตััะธะน
3. **ะกะพะทะดะฐะฝะธะต diff**: ะคะพัะผะธััะตััั ะฐััะธะฒ ั ะฝะพะฒัะผะธ/ะธะทะผะตะฝัะฝะฝัะผะธ ะฟะฐะบะตัะฐะผะธ
4. **ะะตัะตะฝะพั**: ะััะธะฒ ัะบะฐัะธะฒะฐะตััั ะธ ะฟะตัะตะฝะพัะธััั ะฒ ะบะพัะฟะพัะฐัะธะฒะฝัั ัะตัั
5. **ะะพะดัะฒะตัะถะดะตะฝะธะต**: ะะพัะปะต ััะฟะตัะฝะพะณะพ ะฟะตัะตะฝะพัะฐ diff ะฟะพะผะตัะฐะตััั ะบะฐะบ transferred

---

## ๐ฆ ะััะธัะตะบัััะฐ

```
npm_repo/
โโโ docker-compose.yml          # ะะดะธะฝะฐั ัะพัะบะฐ ะทะฐะฟััะบะฐ
โโโ .env                        # ะะพะฝัะธะณััะฐัะธั
โ
โโโ verdaccio/                  # Verdaccio (NPM Registry)
โ   โโโ conf/
โ   โ   โโโ config.yaml         # ะะพะฝัะธะณััะฐัะธั Verdaccio
โ   โโโ storage/                # ะะตั ะฟะฐะบะตัะพะฒ (ะพัะฝะพะฒะฝะพะน)
โ   โโโ frozen/                 # ะะพะฟะธั ะฟะตัะตะฝะตััะฝะฝะพะณะพ ะฒ ะบะพัะฟ.ัะตัั
โ
โโโ webapp/                     # Next.js ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธะต
โ   โโโ src/
โ   โ   โโโ app/               # ะกััะฐะฝะธัั ะธ API routes
โ   โ   โโโ components/        # React ะบะพะผะฟะพะฝะตะฝัั
โ   โ   โโโ lib/               # ะะธะทะฝะตั-ะปะพะณะธะบะฐ + SQLite
โ   โโโ defaults/              # ะะตัะพะปัะฝัะต ะบะพะฝัะธะณะธ
โ   โ   โโโ networks.json      # ะะตัะพะปัะฝัะต ัะตัะธ
โ   โโโ data/                  # SQLite ะะ ะธ ะปะพะณะธ ะทะฐะดะฐั
โ   โ   โโโ npm-hub.db         # ะัะฝะพะฒะฝะฐั ะฑะฐะทะฐ ะดะฐะฝะฝัั
โ   โโโ logs/                  # ะะพะณะธ ะทะฐะดะฐั
โ
โโโ scripts/                    # Python ัะบัะธะฟัั ะพะฟะตัะฐัะธะน
โ   โโโ update_all.py          # ะะพะปะฝะพะต ะพะฑะฝะพะฒะปะตะฝะธะต
โ   โโโ update_recent.py       # ะะฑะฝะพะฒะปะตะฝะธะต ะฝะตะดะฐะฒะฝะธั
โ   โโโ check_broken.py        # ะัะพะฒะตัะบะฐ ะฐััะธะฒะพะฒ
โ   โโโ fix_broken.py          # ะัะฟัะฐะฒะปะตะฝะธะต ะฑะธััั
โ   โโโ create_diff.py         # ะกะพะทะดะฐะฝะธะต diff
โ   โโโ sync_frozen.py         # ะกะธะฝััะพะฝะธะทะฐัะธั frozen
โ
โโโ diff_archives/              # ะััะธะฒั ะดะปั ัะบะฐัะธะฒะฐะฝะธั
```

### ๐๏ธ ะฅัะฐะฝะตะฝะธะต ะดะฐะฝะฝัั

npmBridge ะธัะฟะพะปัะทัะตั **SQLite** ะดะปั ััะฐะฝะตะฝะธั ะฒัะตั ะดะฐะฝะฝัั:

- ะััะพัะธั ะพะฑะฝะพะฒะปะตะฝะธะน, diff, ะฟัะพะฒะตัะพะบ
- ะะพะฝัะธะณััะฐัะธั ัะตัะตะน
- ะัะพะณัะตัั ะธ ััะฐััั ะทะฐะดะฐั

**ะคะฐะนะป ะฑะฐะทั ะดะฐะฝะฝัั**: `webapp/data/npm-hub.db`

**ะะตัะพะปัะฝัะต ะบะพะฝัะธะณะธ**: `webapp/defaults/networks.json` โ ะทะฐะณััะถะฐัััั ะฟัะธ ะฟะตัะฒะพะผ ะทะฐะฟััะบะต, ะตัะปะธ ะะ ะฟัััะฐ.

---

## ๐ ะัััััะน ััะฐัั

### ะขัะตะฑะพะฒะฐะฝะธั

- Docker & Docker Compose
- 50+ GB ัะฒะพะฑะพะดะฝะพะณะพ ะผะตััะฐ (ะดะปั storage)

### ะะฐะฟััะบ

```bash
# ะะปะพะฝะธััะนัะต ัะตะฟะพะทะธัะพัะธะน
git clone <repo-url>
cd npm_repo

# ะกะบะพะฟะธััะนัะต ะบะพะฝัะธะณััะฐัะธั
cp .env.example .env

# ะะฐัััะพะนัะต ะฟัะฐะฒะฐ ะฝะฐ storage
chmod 777 verdaccio/storage

# ะะฐะฟัััะธัะต ัะตัะฒะธัั
docker-compose up -d
```

### ะะพัััะฟ

| ะกะตัะฒะธั | URL | ะะฟะธัะฐะฝะธะต |
|--------|-----|----------|
| **npmBridge** | http://localhost:4013 | ะะตะฑ-ะธะฝัะตััะตะนั ัะฟัะฐะฒะปะตะฝะธั |
| **Verdaccio** | http://localhost:4873 | NPM Registry |

### ะัะฟะพะปัะทะพะฒะฐะฝะธะต Verdaccio

```bash
# ะฃััะฐะฝะพะฒะบะฐ registry ะณะปะพะฑะฐะปัะฝะพ
npm config set registry http://localhost:4873

# ะะปะธ ะดะปั ะบะพะฝะบัะตัะฝะพะณะพ ะฟัะพะตะบัะฐ (ะฒ .npmrc)
registry=http://localhost:4873
```

---

## ๐ฅ๏ธ ะะตะฑ-ะธะฝัะตััะตะนั

### ะะบะปะฐะดะบะธ

| ะะบะปะฐะดะบะฐ | ะคัะฝะบัะธะพะฝะฐะป |
|---------|------------|
| **ะะฑะฝะพะฒะปะตะฝะธะต** | ะะฐะฟััะบ ะพะฑะฝะพะฒะปะตะฝะธั ะฟะฐะบะตัะพะฒ, ะธััะพัะธั ะทะฐะฟััะบะพะฒ ะทะฐะดะฐั |
| **Diff** | ะกะพะทะดะฐะฝะธะต ะฐััะธะฒะฐ ะธะทะผะตะฝะตะฝะธะน, ัะบะฐัะธะฒะฐะฝะธะต, ะฟะพะดัะฒะตัะถะดะตะฝะธะต ะฟะตัะตะฝะพัะฐ ะดะปั ะบะฐะถะดะพะน ัะตัะธ |
| **ะัะพะฒะตัะบะฐ** | ะะพะธัะบ ะธ ะธัะฟัะฐะฒะปะตะฝะธะต ะฑะธััั .tgz ะฐััะธะฒะพะฒ |
| **Storage** | ะคะฐะนะปะพะฒัะน ะฑัะฐัะทะตั ะฟะฐะบะตัะพะฒ |
| **ะััะพัะธั ะฟะฐะบะตัะพะฒ** | ะฅัะพะฝะพะปะพะณะธั ะฟะพัะฒะปะตะฝะธั ะฟะฐะบะตัะพะฒ ั ะฒะตััะธัะผะธ |
| **ะกะตัะธ** | ะฃะฟัะฐะฒะปะตะฝะธะต ะบะพัะฟะพัะฐัะธะฒะฝัะผะธ ัะตััะผะธ ะดะปั ะฟะตัะตะฝะพัะฐ |

---

## ๐ Workflow: ะะฑะฝะพะฒะปะตะฝะธะต ะฟะฐะบะตัะพะฒ

```text
โโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ
โ  ะะฐะฟััะบ ะทะฐะดะฐัะธ   โโโโโโบโ   ะะฐัะฐะปะปะตะปัะฝะฐั   โโโโโโบโ    ะะตะทัะปััะฐั     โ
โ                  โ     โ   ัััะฐะฝะพะฒะบะฐ      โ     โ                  โ
โ โข ะะพะปะฝะพะต         โ     โ   ะฟะฐะบะตัะพะฒ        โ     โ โข ะฃัะฟะตั/ะัะธะฑะบะธ   โ
โ โข ะะตะดะฐะฒะฝะธะต (N ั) โ     โ   (40 ะฟะพัะพะบะพะฒ)   โ     โ โข ะะพะณ ัะฐะนะป       โ
โโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ
```

### ะขะธะฟั ะพะฑะฝะพะฒะปะตะฝะธั

| ะขะธะฟ | ะะฟะธัะฐะฝะธะต | ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั |
|-----|----------|-------------------|
| **ะะพะปะฝะพะต** | ะะฑะฝะพะฒะปัะตั ะะกะ ะฟะฐะบะตัั ะฒ storage ะดะพ latest | ะะตัะฒัะน ะทะฐะฟััะบ, ะบัะธัะธัะตัะบะธะต ะพะฑะฝะพะฒะปะตะฝะธั |
| **ะะตะดะฐะฒะฝะธะต** | ะขะพะปัะบะพ ะฟะฐะบะตัั, ะธะทะผะตะฝัะฝะฝัะต ะทะฐ N ัะฐัะพะฒ | ะะตะณัะปััะฝะพะต ะพะฑะฝะพะฒะปะตะฝะธะต |

### ะะฐัััะพะนะบะธ

- **ะะฐัะฐะปะปะตะปัะฝะพััั**: ะบะพะปะธัะตััะฒะพ ะพะดะฝะพะฒัะตะผะตะฝะฝัั ัััะฐะฝะพะฒะพะบ (ะฟะพ ัะผะพะปัะฐะฝะธั 40)
- **ะะตัะธะพะด "ะฝะตะดะฐะฒะฝะธั"**: ัะบะพะปัะบะพ ัะฐัะพะฒ ะฝะฐะทะฐะด ััะธัะฐัั "ะฝะตะดะฐะฒะฝะธะผ" (ะฟะพ ัะผะพะปัะฐะฝะธั 48ั)

---

## ๐ค Workflow: ะกะพะทะดะฐะฝะธะต ะธ ะฟะตัะตะฝะพั Diff

### ะะพะฝัะตะฟัะธั

```text
storage/          frozen/              diff_archives/
(ะฐะบััะฐะปัะฝัะต       (ะบะพะฟะธั ะฟะพัะปะต         (ะฐััะธะฒั ะดะปั
 ะฟะฐะบะตัั)          ะฟะตัะฒะพะณะพ ะฟะตัะตะฝะพัะฐ)     ะฟะตัะตะฝะพัะฐ)
    โ                  โ                    โ
    โโโโโโโ diff โโโโโโโ                    โ
                โ                           โ
                โโโโโโโโโ archive โโโโโโโโโโโ
```

### ะะพะดะดะตัะถะบะฐ ะผะฝะพะถะตััะฒะตะฝะฝัั ัะตัะตะน

npmBridge ะฟะพะดะดะตัะถะธะฒะฐะตั ะฟะตัะตะฝะพั ะฟะฐะบะตัะพะฒ ะฒ ะฝะตัะบะพะปัะบะพ ะบะพัะฟะพัะฐัะธะฒะฝัั ัะตัะตะน ะพะดะฝะพะฒัะตะผะตะฝะฝะพ.

**ะะฐะถะฝะพ**: ะกะตัะธ โ ััะพ **ะผะตัะบะธ ะดะปั ะพััะปะตะถะธะฒะฐะฝะธั**, ะฒ ะบะฐะบะธะต ะบะพัะฟะพัะฐัะธะฒะฝัะต ัะตัะธ ะฑัะป ะฟะตัะตะฝะตััะฝ diff. ะะฐะฟะบะธ `frozen/` ะธ `diff_archives/` **ะพะฑัะธะต** ะดะปั ะฒัะตั ัะตัะตะน.

```text
                       โโโโโโโโโโโโโโโโโโโโโโโ
                       โ       storage/      โ
                       โโโโโโโโโโโโฌโโโโโโโโโโโ
                                  โ diff
                                  โผ
                       โโโโโโโโโโโโโโโโโโโโโโโ
                       โ       frozen/       โ  โ ะะดะฝะฐ ะพะฑัะฐั ะฟะฐะฟะบะฐ
                       โ (ัะธะฝััะพะฝะธะทะธััะตััั   โ
                       โ  ะฟัะธ ะฟะตัะฒะพะผ ะฟะตัะตะฝะพัะตโ
                       โ  ะฒ ะปัะฑัั ัะตัั)      โ
                       โโโโโโโโโโโโโโโโโโโโโโโ
                                  โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โผ                         โผ                         โผ
  [ะกะตัั: default]         [ะกะตัั: backup]          [ะกะตัั: site-x]
  (ะผะตัะบะฐ ะฟะตัะตะฝะพัะฐ)        (ะผะตัะบะฐ ะฟะตัะตะฝะพัะฐ)        (ะผะตัะบะฐ ะฟะตัะตะฝะพัะฐ)
```

- **ะะบะปะฐะดะบะฐ "ะกะตัะธ"**: ัะฟัะฐะฒะปะตะฝะธะต ัะฟะธัะบะพะผ ะบะพัะฟะพัะฐัะธะฒะฝัั ัะตัะตะน
- **ะะฐะทะดะตะปัะฝะพะต ะพััะปะตะถะธะฒะฐะฝะธะต**: ะพัะผะตัะฐะตััั, ะฒ ะบะฐะบะธะต ัะตัะธ ะฟะตัะตะฝะตััะฝ ะบะฐะถะดัะน diff
- **ะงะฐััะธัะฝัะน ะฟะตัะตะฝะพั**: diff ะผะพะถะตั ะฑััั ะฟะตัะตะฝะตััะฝ ะฒ ะพะดะฝั ัะตัั, ะฝะพ ะตัั ะพะถะธะดะฐัั ะฟะตัะตะฝะพัะฐ ะฒ ะดััะณะธะต
- **ะฆะฒะตัะพะฒะฐั ะผะฐัะบะธัะพะฒะบะฐ**: ะบะฐะถะดะฐั ัะตัั ะธะผะตะตั ัะฒะพะน ัะฒะตั ะดะปั ะฒะธะทัะฐะปัะฝะพะน ะธะดะตะฝัะธัะธะบะฐัะธะธ

### ะกะพััะพัะฝะธั Diff

```text
                    โโโโโโโโโโโโโโโ
                    โ   (ะฝะตั)     โ
                    โโโโโโโโฌโโโโโโโ
                           โ ัะพะทะดะฐัั diff
                           โผ
                    โโโโโโโโโโโโโโโ
          โโโโโโโโโโบโ   pending   โโโโโโโโโโโ
          โ         โ (ะพะถะธะดะฐะตั    โ         โ
          โ         โ  ะฟะตัะตะฝะพัะฐ)  โ         โ
          โ         โโโโโโโโฌโโโโโโโ         โ
          โ                โ                โ
          โ  ะฟะพะดัะฒะตัะดะธัั   โ  ะฟะพัะฒะธะปะธัั     โ
          โ  ะดะปั ะงะะกะขะ     โ  ะฝะพะฒัะต ะฟะฐะบะตัั  โ
          โ  ัะตัะตะน         โ                โ
          โ                โผ                โ
          โ         โโโโโโโโโโโโโโโ         โ
          โ         โ   partial   โโโโโโโโโโโค
          โ         โ (ัะฐััั ัะตัะตะนโ         โ
          โ         โ ะฟะพะดัะฒะตัะถะดะตะฝะฐโ         โ
          โ         โโโโโโโโฌโโโโโโโ         โ
          โ                โ                โ
          โ                โ ะฟะพะดัะฒะตัะดะธัั    โ
          โ                โ ะะกะ ัะตัะธ       โ
          โ                โผ                โ
          โ         โโโโโโโโโโโโโโโ         โ
          โโโโโโโโโโโ transferred โ         โ
                    โ (ะฒัะต ัะตัะธ   โ         โ
                    โ ะพัะผะตัะตะฝั)   โ         โ
                    โโโโโโโโโโโโโโโ         โ
                                            โ
                    โโโโโโโโโโโโโโโ         โ
                    โ  outdated   โโโโโโโโโโโ
                    โ (ะฟะพัะฒะธะปะธัั  โ
                    โ ะฝะพะฒัะต ะฟะฐะบะตััโ
                    โโโโโโโโโโโโโโโ
```

**ะะพะณะธะบะฐ ะฟะตัะตัะพะดะพะฒ:**

- `pending` โ `partial`: ะพัะผะตัะตะฝ ะฟะตัะตะฝะพั ัะพัั ะฑั ะฒ ะพะดะฝั ัะตัั, ะฝะพ ะฝะต ะฒะพ ะฒัะต
- `pending` โ `transferred`: ะพัะผะตัะตะฝ ะฟะตัะตะฝะพั ะฒะพ ะฒัะต ัััะตััะฒัััะธะต ัะตัะธ (ะตัะปะธ ะพะดะฝะฐ ัะตัั)
- `partial` โ `transferred`: ะพัะผะตัะตะฝั ะฒัะต ะพััะฐะฒัะธะตัั ัะตัะธ
- `pending`/`partial` โ `outdated`: ะฟะพัะฒะธะปะธัั ะฝะพะฒัะต ะฟะฐะบะตัั ะฒ storage

### ะัะพัะตัั ะฟะตัะตะฝะพัะฐ

1. **ะกะพะทะดะฐัั Diff** โ ััะฐะฒะฝะธะฒะฐะตั `storage/` ั `frozen/`, ัะพะทะดะฐัั ะฐััะธะฒ
2. **ะกะบะฐัะฐัั ะฐััะธะฒ** โ ัะตัะตะท ะฑัะฐัะทะตั (ะบะฝะพะฟะบะฐ "ะกะบะฐัะฐัั")
3. **ะะตัะตะฝะตััะธ ะฒ ะบะพัะฟ.ัะตัั** โ ะฒัััะฝัั (ะฝะฐ ัะปะตัะบะต, ัะตัะตะท ัะปัะท ะธ ั.ะด.)
4. **ะะพะดัะฒะตัะดะธัั ะฟะตัะตะฝะพั ะดะปั ัะตัะธ** โ ะฒัะฑัะฐัั ัะตัั ะธ ะฟะพะดัะฒะตัะดะธัั
5. **ะะพะฒัะพัะธัั ะดะปั ะดััะณะธั ัะตัะตะน** โ ะตัะปะธ ะฝัะถะตะฝ ะฟะตัะตะฝะพั ะฒ ะฝะตัะบะพะปัะบะพ ัะตัะตะน

### ะกะธะฝััะพะฝะธะทะฐัะธั frozen

ะัะธ **ะฟะตัะฒะพะผ** ะฟะพะดัะฒะตัะถะดะตะฝะธะธ ะฟะตัะตะฝะพัะฐ (ะฒ ะปัะฑัั ัะตัั) ะฟัะพะธััะพะดะธั ัะธะฝััะพะฝะธะทะฐัะธั `frozen/` ั `storage/`. ะญัะพ ะฝัะถะฝะพ ะดะปั ะบะพััะตะบัะฝะพะณะพ ัะพะทะดะฐะฝะธั ัะปะตะดัััะตะณะพ diff.

### ะกัะตะฝะฐัะธะน: ะัััะฐััะฐั ัะตัั

ะัะปะธ ะพะดะฝะฐ ะธะท ัะตัะตะน ะพัััะฐะปะฐ ะฝะฐ ะฝะตัะบะพะปัะบะพ diff (ะฝะฐะฟัะธะผะตั, "ะะตะทะตัะฒะฝะฐั ะฟะปะพัะฐะดะบะฐ" ะดะฐะฒะฝะพ ะฝะต ะพะฑะฝะพะฒะปัะปะฐัั):

```text
ะัะธะผะตั:
- ะกะตัั "ะัะฝะพะฒะฝะฐั" โ ะฐะบััะฐะปัะฝะฐ (ะฒัะต diff ะฟะตัะตะฝะตัะตะฝั)
- ะกะตัั "ะะตะทะตัะฒะฝะฐั" โ ะพัััะฐัั ะฝะฐ 3 diff

ะะตัะตะฝะธะต: ะะพัะปะตะดะพะฒะฐัะตะปัะฝะฐั ะทะฐะณััะทะบะฐ diff ะฒ ะพัััะฐัััั ัะตัั

1. ะะฐะนัะธ ะฟะตัะฒัะน ะฝะตะฟะตัะตะฝะพััะฝะฝัะน diff ะดะปั "ะะตะทะตัะฒะฝะพะน"
2. ะกะบะฐัะฐัั ะตะณะพ ะฐััะธะฒ
3. ะะฐะณััะทะธัั ะฒ "ะะตะทะตัะฒะฝัั" ัะตัั
4. ะะพะดัะฒะตัะดะธัั ะฟะตัะตะฝะพั
5. ะะพะฒัะพัะธัั ะดะปั ัะปะตะดัััะธั diff
```

### ะะฐะถะฝะพ

- โ๏ธ **ะะดะธะฝ ะฐะบัะธะฒะฝัะน diff**: ะผะพะถะตั ะฑััั ัะพะปัะบะพ ะพะดะธะฝ `pending`/`partial` diff
- โ๏ธ **ะะฒัะพะผะฐัะธัะตัะบะพะต ัััะฐัะตะฒะฐะฝะธะต**: ะตัะปะธ ะฟะพัะฒะธะปะธัั ะฝะพะฒัะต ะฟะฐะบะตัั, ััะฐััะน diff ััะฐะฝะพะฒะธััั `outdated`
- โ **ะกะพััะฐะฝะตะฝะธะต ะฐััะธะฒะพะฒ**: ะฐััะธะฒั ัะดะฐะปััััั ัะพะปัะบะพ ะดะปั diff ัะพ ััะฐัััะพะผ `transferred` (ะฟะตัะตะฝะตัะตะฝั ะฒะพ ะะกะ ัะตัะธ). ะััะธะฒั `outdated` ะธ `partial` diff ัะพััะฐะฝััััั ะดะปั ะพัััะฐััะธั ัะตัะตะน
- โ **ะะฑัะธะน frozen**: ะพะดะฝะฐ ะดะธัะตะบัะพัะธั `frozen/` ะดะปั ะฒัะตั ัะตัะตะน (ัะธะฝััะพะฝะธะทะธััะตััั ะฟัะธ ะฟะตัะฒะพะผ ะฟะตัะตะฝะพัะต)

---

## ๐ ะัะพะฒะตัะบะฐ ัะตะปะพััะฝะพััะธ

### Workflow

```
โโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ
โ  ะัะพะฒะตัะบะฐ ะฒัะตั   โโโโโโบโ  ะะฐะนะดะตะฝั ะฑะธััะต   โโโโโโบโ   ะะฒัะพะผะฐัะธัะตัะบะพะต โ
โ  .tgz ะฐััะธะฒะพะฒ    โ     โ  ะฐััะธะฒั?         โ     โ   ะธัะฟัะฐะฒะปะตะฝะธะต    โ
โ                  โ     โ                  โ     โ                  โ
โ  tar -tzf        โ     โ  broken.txt      โ     โ  ะะตัะตัััะฐะฝะพะฒะบะฐ   โ
โโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ
```

### ะัะธัะธะฝั ะฟะพะฒัะตะถะดะตะฝะธั

- ะัะตัะฒะฐะฝะฝะฐั ะทะฐะณััะทะบะฐ
- ะัะพะฑะปะตะผั ั ัะตััั
- ะะตัะฒะฐัะบะฐ ะผะตััะฐ ะฝะฐ ะดะธัะบะต

---

## ๐ Storage Browser

ะะพะทะฒะพะปัะตั ะฟัะพัะผะฐััะธะฒะฐัั ัะพะดะตัะถะธะผะพะต ัะตะฟะพะทะธัะพัะธั:

- ๐ ะะตัะตะฒะพ ะฟะฐะบะตัะพะฒ (scoped ะธ ะพะฑััะฝัะต)
- ๐ฆ ะกะฟะธัะพะบ ะฒะตััะธะน ะบะฐะถะดะพะณะพ ะฟะฐะบะตัะฐ
- ๐ ะะฐัะฐ ะดะพะฑะฐะฒะปะตะฝะธั
- ๐ ะะฐะทะผะตั ัะฐะนะปะพะฒ

---

## ๐ ะััะพัะธั ะฟะฐะบะตัะพะฒ

ะฅัะพะฝะพะปะพะณะธัะตัะบะธะน ะถััะฝะฐะป ะฒัะตั ะฟะฐะบะตัะพะฒ:

- ะะพะณะดะฐ ะฟะฐะบะตั ะฟะพัะฒะธะปัั ะฒ storage (mtime ัะฐะนะปะฐ)
- ะัะต ะฒะตััะธะธ ะฟะฐะบะตัะฐ
- ะะฐะทะผะตั ะบะฐะถะดะพะน ะฒะตััะธะธ
- ะกัะฐัะธััะธะบะฐ: ะฒัะตะณะพ ะฟะฐะบะตัะพะฒ, ะฒะตััะธะน, ะพะฑัะธะน ัะฐะทะผะตั

---

## โ๏ธ ะะพะฝัะธะณััะฐัะธั

### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั (.env)

| ะะตัะตะผะตะฝะฝะฐั | ะะพ ัะผะพะปัะฐะฝะธั | ะะฟะธัะฐะฝะธะต |
|------------|--------------|----------|
| `VERDACCIO_PORT` | 4873 | ะะพัั Verdaccio |
| `WEBAPP_PORT` | 4013 | ะะพัั ะฒะตะฑ-ะธะฝัะตััะตะนัะฐ |
| `STORAGE_DIR` | ./verdaccio/storage | ะััั ะบ storage |
| `FROZEN_DIR` | ./verdaccio/frozen | ะััั ะบ frozen |
| `DIFF_ARCHIVES_DIR` | ./diff_archives | ะััั ะบ ะฐััะธะฒะฐะผ diff |
| `SCRIPTS_DIR` | ./scripts | ะััั ะบ Python ัะบัะธะฟัะฐะผ |
| `PARALLEL_JOBS` | 40 | ะะฐัะฐะปะปะตะปัะฝะพััั ะพะฑะฝะพะฒะปะตะฝะธั |
| `MODIFIED_MINUTES` | 2880 | ะะตัะธะพะด "ะฝะตะดะฐะฒะฝะธั" (ะผะธะฝััั) |

### Verdaccio (verdaccio/conf/config.yaml)

```yaml
storage: /verdaccio/storage
uplinks:
  npmjs:
    url: https://registry.npmjs.org/
packages:
  '**':
    access: $all
    publish: $all
    proxy: npmjs
```

---

## ๐๏ธ API Endpoints

### ะะฑะฝะพะฒะปะตะฝะธะต

| ะะตัะพะด | Endpoint | ะะฟะธัะฐะฝะธะต |
|-------|----------|----------|
| GET | `/api/update` | ะกัะฐััั ะธ ะธััะพัะธั ะพะฑะฝะพะฒะปะตะฝะธะน |
| POST | `/api/update` | ะะฐะฟััะบ ะพะฑะฝะพะฒะปะตะฝะธั |
| DELETE | `/api/update?taskId=...` | ะััะฐะฝะพะฒะบะฐ ะทะฐะดะฐัะธ |

### Diff

| ะะตัะพะด | Endpoint | ะะฟะธัะฐะฝะธะต |
|-------|----------|----------|
| GET | `/api/diff` | ะกะฟะธัะพะบ diff ะธ ััะฐััั |
| POST | `/api/diff` | ะกะพะทะดะฐัั ะฝะพะฒัะน diff |
| PUT | `/api/diff` | ะะพะดัะฒะตัะดะธัั ะฟะตัะตะฝะพั |
| GET | `/api/diff/download/[id]` | ะกะบะฐัะฐัั ะฐััะธะฒ |

### ะัะพะฒะตัะบะฐ

| ะะตัะพะด | Endpoint | ะะฟะธัะฐะฝะธะต |
|-------|----------|----------|
| GET | `/api/broken` | ะกัะฐััั ะฟัะพะฒะตัะบะธ |
| POST | `/api/broken` | ะะฐะฟััะบ ะฟัะพะฒะตัะบะธ/ะธัะฟัะฐะฒะปะตะฝะธั |

### Storage

| ะะตัะพะด | Endpoint | ะะฟะธัะฐะฝะธะต |
|-------|----------|----------|
| GET | `/api/storage?action=list` | ะกะฟะธัะพะบ ะฟะฐะบะตัะพะฒ |
| GET | `/api/storage?action=stats` | ะกัะฐัะธััะธะบะฐ |
| GET | `/api/storage?action=history` | ะััะพัะธั ะฟะฐะบะตัะพะฒ |
| GET | `/api/storage?action=package&package=...` | ะะฝัะพัะผะฐัะธั ะพ ะฟะฐะบะตัะต |

---

## ๐ ะะฐะทัะฐะฑะพัะบะฐ

### ะะพะบะฐะปัะฝัะน ะทะฐะฟััะบ

```bash
cd webapp

# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
pnpm install

# ะะฐัััะพะนะบะฐ ะพะบััะถะตะฝะธั
cp .env.example .env.local
# ะััะตะดะฐะบัะธััะนัะต ะฟััะธ ะฒ .env.local

# ะะฐะฟััะบ ะฒ ัะตะถะธะผะต ัะฐะทัะฐะฑะพัะบะธ
pnpm dev
```

### ะกะฑะพัะบะฐ

```bash
pnpm build
pnpm start
```

### Docker build

```bash
docker-compose build
docker-compose up -d
```

---

## ๐ Troubleshooting

### Verdaccio ะฝะต ะทะฐะฟััะบะฐะตััั

```bash
# ะัะพะฒะตัััะต ะฟัะฐะฒะฐ ะฝะฐ storage
chmod -R 777 verdaccio/storage

# ะัะพะฒะตัััะต ะปะพะณะธ
docker-compose logs verdaccio
```

### ะัะธะฑะบะธ ะฟัะธ ะพะฑะฝะพะฒะปะตะฝะธะธ ะฟะฐะบะตัะพะฒ

```bash
# ะัะพะฒะตัััะต ะดะพัััะฟะฝะพััั registry
curl http://localhost:4873/-/ping

# ะัะพะฒะตัััะต ะปะพะณะธ ะทะฐะดะฐัะธ ะฒ webapp/logs/
```

### ะะพะปััะพะน ัะฐะทะผะตั diff

- ะญัะพ ะฝะพัะผะฐะปัะฝะพ ะฟัะธ ะฟะตัะฒะพะผ ะฟะตัะตะฝะพัะต ะธะปะธ ะฟะพัะปะต ะดะพะปะณะพะณะพ ะฟะตัะตััะฒะฐ
- ะะพะถะฝะพ ัะผะตะฝััะธัั ะฟะฐัะฐะปะปะตะปัะฝะพััั ะดะปั ัะฝะธะถะตะฝะธั ะฝะฐะณััะทะบะธ

---

## ๐ ะะธัะตะฝะทะธั

MIT

---

## ๐ค Contributing

Pull requests welcome!
